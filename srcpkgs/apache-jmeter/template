# Template file for 'apache-jmeter'
pkgname=apache-jmeter
version=5.2.1
revision=2
hostmakedepends="openjdk8 apache-ant which gradle tar"
depends="virtual?java-runtime"
short_desc="Application to load test functional behavior and measure performance"
maintainer="Kyle Nusbaum <knusbaum+void@sdf.org>"
license="Apache-2.0"
homepage="https://jmeter.apache.org/"
distfiles="https://archive.apache.org/dist/jmeter/source/apache-jmeter-${version}_src.tgz"
checksum=12fbeb7cca295ecff25077bc297d5cdfeb2b6722e48a464a722705fbf6ee89a2

do_build() {
	./gradlew :src:dist:assemble
}

do_install() {
	vmkdir /usr/libexec/apache-jmeter
	tar -xvz --strip-components 1 -f src/dist/build/distributions/apache-jmeter-${version}-SNAPSHOT.tgz -C ${DESTDIR}/usr/libexec/apache-jmeter

	vmkdir /usr/bin
	ln -s /usr/libexec/apache-jmeter/bin/jmeter ${DESTDIR}/usr/bin/jmeter
}

apache-jmeter-doc_package() {
	archs=noarch
	short_desc+=" - documentation"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove /usr/libexec/apache-jmeter/docs
		vmove /usr/libexec/apache-jmeter/printable_docs
	}
}
