# Template file for 'podman'
pkgname=podman
version=0.11.1.1
revision=1
wrksrc="libpod-${version}"
build_style=go
go_import_path="github.com/containers/libpod"
conf_files="/etc/containers/registries.conf /etc/cni/net.d/*"
hostmakedepends="git pkg-config"
makedepends="gpgme-devel libseccomp-devel"
depends="cri-o runc cni-plugins skopeo"
short_desc="A library used to create container pods"
maintainer="Kyle Nusbaum <knusbaum+void@sdf.org>"
license="Apache-2.0"
homepage="https://podman.io/"
distfiles="https://github.com/containers/libpod/archive/v${version}.tar.gz"
checksum=c2ca01bfa31f8f6034c2b230a4187f0c9b4216da14f7ba2a4d2eece13de71683

pre_build() {
	GOOS='' GOARCH='' CGO_CFLAGS='' CGO_CXXFLAGS='' CC=/bin/gcc \
		go get -u github.com/varlink/go/varlink/idl
	GOOS='' GOARCH='' CGO_CFLAGS='' CGO_CXXFLAGS='' CC=/bin/gcc  \
		make install.tools
	GOOS='' GOARCH='' CGO_CFLAGS='' CGO_CXXFLAGS='' CC=/bin/gcc  \
		make varlink_generate
	GOOS='' GOARCH='' CGO_CFLAGS='' CGO_CXXFLAGS='' CC=/bin/gcc  \
		make easyjson_generate
}

do_build() {
	unset LDFLAGS
	make podman
}

do_install() {
	make install.bin PREFIX=${DESTDIR}/usr DESTDIR=${DESTDIR}
	make install.man PREFIX=${DESTDIR}/usr DESTDIR=${DESTDIR}
	make install.cni PREFIX=${DESTDIR}/usr DESTDIR=${DESTDIR}

	vinstall ${FILESDIR}/registries.conf 664 etc/containers/
}
